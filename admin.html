document.addEventListener('DOMContentLoaded', () => {
    const playerLoginSignupButton = document.getElementById('player-login-signup-button');
    const playerLoginSignupForm = document.getElementById('player-login-signup-form');
    const playerLoginButton = document.getElementById('player-login-button');
    const playerSignupButton = document.getElementById('player-signup-button');
    const cookieClickerGame = document.getElementById('cookie-clicker-game');
    const cookieCountElement = document.getElementById('cookie-count');
    const cookie = document.getElementById('cookie');
    const upgradeButton = document.getElementById('upgrade-button');
    const playerUsernameInput = document.getElementById('player-username');
    const playerPasswordInput = document.getElementById('player-password');

    let currentPlayer = null;
    let cookies = 0;

    playerLoginSignupButton.addEventListener('click', () => {
        playerLoginSignupForm.classList.toggle('d-none');
    });

    playerSignupButton.addEventListener('click', () => {
        const username = playerUsernameInput.value.trim();
        const password = playerPasswordInput.value.trim();

        if (username && password) {
            if (localStorage.getItem(`player_${username}`)) {
                alert('Username already exists. Please choose a different username.');
            } else {
                localStorage.setItem(`player_${username}`, JSON.stringify({ password, cookies: 0 }));
                alert('Signup successful! You can now log in.');
            }
        } else {
            alert('Please enter both username and password.');
        }
    });

    playerLoginButton.addEventListener('click', () => {
        const username = playerUsernameInput.value.trim();
        const password = playerPasswordInput.value.trim();

        const storedPlayer = JSON.parse(localStorage.getItem(`player_${username}`));

        if (storedPlayer && storedPlayer.password === password) {
            currentPlayer = username;
            cookies = storedPlayer.cookies;
            cookieCountElement.textContent = `Cookies: ${cookies}`;
            alert(`Welcome, ${username}!`);
            playerLoginSignupForm.classList.add('d-none');
            cookieClickerGame.classList.remove('d-none');
        } else {
            alert('Invalid username or password.');
        }
    });

    cookie.addEventListener('click', () => {
        if (currentPlayer) {
            cookies++;
            cookieCountElement.textContent = `Cookies: ${cookies}`;
            localStorage.setItem(`player_${currentPlayer}`, JSON.stringify({ password: JSON.parse(localStorage.getItem(`player_${currentPlayer}`)).password, cookies }));
        } else {
            alert('You need to log in first!');
        }
    });

    upgradeButton.addEventListener('click', () => {
        if (currentPlayer) {
            // Add upgrade functionality here
            alert('Upgrade purchased!');
        } else {
            alert('You need to log in first!');
        }
    });
});
